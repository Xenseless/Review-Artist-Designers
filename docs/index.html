<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Artist/Designers</title>

    <script type="text/javascript" src="extras/jquery.min.1.7.js"></script> 
    <script type="text/javascript" src="extras/modernizr.2.5.3.min.js"></script> 
    <script type="text/javascript" src="lib/hash.js"></script>
</head>
<body>

<div id="canvas">
    <div class="zoom-icon zoom-icon-in"></div>
    <div class="magazine-viewport">
        <div class="container">
            <div class="magazine">
                <div ignore="1" class="next-button"></div>
                <div ignore="1" class="previous-button"></div>
            </div>
        </div>
    </div>
</div>

<!-- Contenedor de animación de texto para "Turn Page" -->
<div class="grab-container">
    <span class="grab-text">Turn Page →</span>
</div>

<script type="text/javascript">
function loadApp() {
    $('#canvas').fadeIn(1000);
    var flipbook = $('.magazine');

    // Check if the CSS was already loaded
    if (flipbook.width() == 0 || flipbook.height() == 0) {
        setTimeout(loadApp, 10);
        return;
    }

    // Function to set flipbook dimensions based on window width
    function setFlipbookSize() {
        let width, height;
        
        if (window.innerWidth <= 375) {
            width = 320;
            height = 200;
        } else if (window.innerWidth <= 680) {
            width = 360;
            height = 220;
        } else {
            width = 922;
            height = 600;
        }
        flipbook.turn('size', width, height);  // Adjust flipbook size dynamically
    }

    flipbook.turn({
        width: 922,
        height: 600,
        duration: 1000,
        acceleration: !isChrome(),
        gradients: true,
        autoCenter: true,
        elevation: 50,
        pages: 18,
        when: {
            turning: function(event, page, view) {
                var book = $(this),
                    currentPage = book.turn('page'),
                    pages = book.turn('pages');
                Hash.go('page/' + page).update();
                disableControls(page);
                $('.thumbnails .page-' + currentPage).parent().removeClass('current');
                $('.thumbnails .page-' + page).parent().addClass('current');
            },
            turned: function(event, page, view) {
                disableControls(page);
                $(this).turn('center');
                if (page == 1) {
                    $(this).turn('peel', 'br');
                }
            },
            missing: function(event, pages) {
                for (var i = 0; i < pages.length; i++) addPage(pages[i], $(this));
            }
        }
    });

    setFlipbookSize();
    $(window).resize(setFlipbookSize);
    $(window).resize(function() {
        resizeViewport();
    }).bind('orientationchange', function() {
        resizeViewport();
    });

    $(document).keydown(function(e){
        var previous = 37, next = 39, esc = 27;
        switch (e.keyCode) {
            case previous:
                $('.magazine').turn('previous');
                e.preventDefault();
                break;
            case next:
                $('.magazine').turn('next');
                e.preventDefault();
                break;
            case esc:
                $('.magazine-viewport').zoom('zoomOut');    
                e.preventDefault();
                break;
        }
    });

    resizeViewport();
    $('.magazine').addClass('animated');
}

// Load the HTML4 version if there's no CSS transform
yepnope({
    test: Modernizr.csstransforms,
    yep: ['lib/turn.js'],
    nope: ['lib/turn.html4.min.js'],
    both: ['js/magazine.js', 'css/magazine.css'],
    complete: loadApp
});

// Animación de "Turn Page" al hacer scroll
document.addEventListener("DOMContentLoaded", function() {
    const grabText = document.querySelector('.grab-text');
    const grabContainer = document.querySelector('.grab-container');
    
    let repeatCount = 0;
    const maxRepeats = 3;

    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting && repeatCount < maxRepeats) {
                grabText.style.animation = "moveGrab 1.5s ease-in-out forwards";
                
                const handleAnimationEnd = () => {
                    repeatCount++;
                    if (repeatCount < maxRepeats) {
                        grabText.style.animation = "none";
                        setTimeout(() => {
                            grabText.style.animation = "moveGrab 1.5s ease-in-out forwards";
                        }, 150);
                    } else {
                        observer.unobserve(grabContainer);
                        grabText.removeEventListener('animationend', handleAnimationEnd);
                    }
                };
                grabText.addEventListener('animationend', handleAnimationEnd);
            }
        });
    });

    observer.observe(grabContainer);
});
</script>

</body>
</html>
